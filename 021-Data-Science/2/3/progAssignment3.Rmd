---
title: "Programming Assignment 3"
author: "Kirill Avilenko"
date: "10/1/2020"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Data exploration

### Outcome of care measures
The Outcome of Care Measures.csv table contains forty seven (47) fields. This table provides each hospitalâ€™s risk-adjusted 30-Day Death (mortality) and 30-Day Readmission category and rate.

Read data from given CSV file:
```{r}
outcome <- read.csv("outcome-of-care-measures.csv", colClasses = "character")
```



### Hospitals
The Hospital_Data.csv table contains thirteen (13) fields. This table provides general Hospital information in response to a Hospital Compare search.


## Part 1: Plot 30-Days mortality rates from heart attack

In order to plot 30-days mortality rates from heart attack we need to find and prepare data from "outcome-of-care-measures" table. The required info is given in column 11, but it is stored as a character.

```{r}
str(outcome[,11])
```

Convert data to numeric format and check data:
```{r}
outcome[, 11] <- as.numeric(outcome[, 11]);
str(outcome[,11])
```

Plot the histogram for 30-days mortality rate from heart attack:
```{r}
hist(outcome[, 11], 
     main='Hospital 30-Day Death (Mortality) Rates from Heart Attack', 
     xlab='Deaths', 
     col='red')
```

## Part 2: Best hospital in a state

In order to define best hospital in a state we need to design a function that takes two arguments:
* 2-character state code
* Outcome name - "heart attack", "heart failure" and "pneumonia"
and returns hospital name.

```{r}
best <- function(state, outcome) {
    ## Read outcome data
    outcomeTbl <- read.csv("outcome-of-care-measures.csv", colClasses = "character")

    ## Check that state is valid
    if (!state %in% unique(outcomeTbl[['State']])) {
        stop('invalid state') ## Throw an error with information message
    }
    ## Check if outcome is valid
    if (!outcome %in% c('heart attack', 'heart failure', 'pneumonia')) {
        stop('invalid outcome')
    }
    
    ## Rename columns
    colnames(outcomeTbl)[11] <- 'heart attack'
    colnames(outcomeTbl)[17] <- 'heart failure'
    colnames(outcomeTbl)[23] <- 'pneumonia'
    
    ## Filter data by state and select only required columns
    outcomeTbl <- outcomeTbl[outcomeTbl$State == state,
                             c("Hospital.Name",
                               "State",
                               "heart attack",
                               "heart failure",
                               "pneumonia")]
    
    ## Convert data to numeric format
    outcomeTbl[, 3:5] <- suppressWarnings(sapply(outcomeTbl[, 3:5], as.numeric))

    ## Filter complete cases (only data without NA)
    outcomeTbl <- outcomeTbl[complete.cases(outcomeTbl), ]
    
    ## Return hospital name in that state with lowest 30-day death ## rate
    return(outcomeTbl[order(outcomeTbl[[outcome]],outcomeTbl$Hospital.Name), ][1,1])
    
}
```

Function tests:
```{r}
best("TX", "heart attack")
best("TX", "heart failure")
best("MD", "heart attack")
best("MD", "pneumonia")
```

## Ranking hospitals by outcome in a state

## Ranking hospitals in all states